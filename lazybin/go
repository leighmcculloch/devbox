#!/usr/bin/env bash

set -o errexit
set -o pipefail
set -o nounset

me="$(basename "$0")"
dir="$LOCAL_BIN/go"

{
  if ! [ -d "$LOCAL_BIN/go*" ] ; then
    echo -e "\e[1;32mInstalling '$me' on first use...\e[0m"

    rm -fr $LOCAL_BIN/go*
    mkdir \
      $LOCAL_BIN/go1.13beta1 \
      $LOCAL_BIN/go1.12.17 \
      $LOCAL_BIN/go1.11.12 \
      $LOCAL_BIN/go1.10.8
    curl https://dl.google.com/go/go1.13beta1.linux-amd64.tar.gz | tar xz --strip-components=1 -C $LOCAL_BIN/go1.13beta1
    curl https://dl.google.com/go/go1.12.7.linux-amd64.tar.gz | tar xz --strip-components=1 -C $LOCAL_BIN/go1.12.17
    curl https://dl.google.com/go/go1.11.12.linux-amd64.tar.gz | tar xz --strip-components=1 -C $LOCAL_BIN/go1.11.12
    curl https://dl.google.com/go/go1.10.8.linux-amd64.tar.gz | tar xz --strip-components=1 -C $LOCAL_BIN/go1.10.8

    echo -e "\e[1;32mFinished installing '$me'.\e[0m"
  fi
} 1>&2

go "$@"
